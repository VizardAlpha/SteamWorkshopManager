<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:SteamWorkshopManager.ViewModels"
        x:Class="SteamWorkshopManager.Views.SetupWizardWindow"
        x:DataType="vm:SetupWizardViewModel"
        Title="{Binding Loc[SetupWizardTitle]}"
        Width="500"
        Height="420"
        WindowStartupLocation="CenterScreen"
        CanResize="False">

    <Border Background="{DynamicResource SystemChromeLowColor}">
        <Grid RowDefinitions="Auto,*,Auto">
            <!-- Header -->
            <Border Grid.Row="0"
                    Background="{DynamicResource SystemAccentColor}"
                    Padding="24,20">
                <StackPanel>
                    <TextBlock Text="{Binding Loc[SetupWizardTitle]}"
                               FontSize="24"
                               FontWeight="SemiBold"
                               Foreground="White" />
                    <TextBlock Text="{Binding Loc[SetupWizardSubtitle]}"
                               FontSize="14"
                               Foreground="White"
                               Opacity="0.9"
                               Margin="0,4,0,0" />
                </StackPanel>
            </Border>

            <!-- Content -->
            <StackPanel Grid.Row="1"
                        Margin="24"
                        Spacing="16">
                <TextBlock Text="{Binding Loc[SetupWizardInstructions]}"
                           TextWrapping="Wrap"
                           Foreground="{DynamicResource SystemBaseHighColor}" />

                <!-- AppId Input -->
                <StackPanel Spacing="8">
                    <TextBlock Text="{Binding Loc[AppIdLabel]}"
                               FontWeight="SemiBold" />
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Grid.Column="0"
                                 Text="{Binding AppIdInput, Mode=TwoWay}"
                                 Watermark="480490"
                                 IsEnabled="{Binding !IsValidating}"
                                 Margin="0,0,8,0" />
                        <Button Grid.Column="1"
                                Content="{Binding Loc[ValidateButton]}"
                                Command="{Binding ValidateAppIdCommand}"
                                IsEnabled="{Binding !IsValidating}"
                                Width="100" />
                    </Grid>
                </StackPanel>

                <!-- Validation Result -->
                <Border IsVisible="{Binding IsValidating}"
                        Padding="12"
                        Background="{DynamicResource SystemListLowColor}"
                        CornerRadius="4">
                    <StackPanel Spacing="8">
                        <ProgressBar IsIndeterminate="True" Height="4" />
                        <TextBlock Text="{Binding Loc[Validating]}"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- Success -->
                <Border IsVisible="{Binding IsValid}"
                        Padding="12"
                        Background="#1a4caf50"
                        BorderBrush="#4caf50"
                        BorderThickness="1"
                        CornerRadius="4">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Grid.Column="0"
                                   Text="✓"
                                   FontSize="20"
                                   Foreground="#4caf50"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0" />
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding GameName}"
                                       FontWeight="SemiBold"
                                       Foreground="#4caf50" />
                            <TextBlock Text="{Binding Loc[WorkshopFound]}"
                                       FontSize="12"
                                       Foreground="#4caf50"
                                       Opacity="0.8" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Error -->
                <Border IsVisible="{Binding HasError}"
                        Padding="12"
                        Background="#1af44336"
                        BorderBrush="#f44336"
                        BorderThickness="1"
                        CornerRadius="4">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Grid.Column="0"
                                   Text="✗"
                                   FontSize="20"
                                   Foreground="#f44336"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0" />
                        <TextBlock Grid.Column="1"
                                   Text="{Binding ErrorMessage}"
                                   Foreground="#f44336"
                                   TextWrapping="Wrap"
                                   VerticalAlignment="Center" />
                    </Grid>
                </Border>
            </StackPanel>

            <!-- Footer -->
            <Border Grid.Row="2"
                    Background="{DynamicResource SystemListLowColor}"
                    Padding="24,16">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0"
                               Text="{Binding Loc[SetupWizardHint]}"
                               FontSize="12"
                               Foreground="{DynamicResource SystemBaseMediumColor}"
                               VerticalAlignment="Center"
                               TextWrapping="Wrap" />
                    <Button Grid.Column="1"
                            Content="{Binding Loc[CreateSessionButton]}"
                            Command="{Binding CreateSessionCommand}"
                            IsEnabled="{Binding IsValid}"
                            Classes="accent"
                            MinWidth="140">
                        <Button.Styles>
                            <Style Selector="Button.accent">
                                <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
                                <Setter Property="Foreground" Value="White" />
                            </Style>
                        </Button.Styles>
                    </Button>
                </Grid>
            </Border>

            <!-- Creating overlay -->
            <Border Grid.Row="0" Grid.RowSpan="3"
                    IsVisible="{Binding IsCreating}"
                    Background="#80000000">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="16"
                            Width="200">
                    <ProgressBar IsIndeterminate="True" Height="6" />
                    <TextBlock Text="{Binding Loc[CreatingSession]}"
                               Foreground="White"
                               FontSize="16"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>
